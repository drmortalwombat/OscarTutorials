#include <c64/vic.h>
#include <c64/sprites.h>
#include <string.h>

// Four sprite images with the animation frames of
// a rotating beach ball

const char SpriteImage[4][64] = {
	{
	0b00000000, 0b11111000, 0b00000000,
	0b00000011, 0b01101110, 0b00000000,
	0b00001100, 0b11100111, 0b10000000,
	0b00010001, 0b11100011, 0b11000000,
	0b00111100, 0b00011110, 0b00100000,
	0b00111100, 0b00011111, 0b00100000,
	0b01111000, 0b00011111, 0b00010000,
	0b01111000, 0b00011111, 0b00010000,
	0b11111000, 0b00011111, 0b10001000,
	0b11110000, 0b00011111, 0b10001000,
	0b10001111, 0b11100000, 0b01111000,
	0b10001111, 0b11100000, 0b01111000,
	0b10000111, 0b11100000, 0b01111000,
	0b01000111, 0b11100000, 0b11110000,
	0b01000111, 0b11100000, 0b11110000,
	0b00100011, 0b11100000, 0b11100000,
	0b00100011, 0b11100001, 0b11100000,
	0b00011110, 0b00011100, 0b01000000,
	0b00001111, 0b00011001, 0b10000000,
	0b00000011, 0b10010110, 0b00000000,
	0b00000000, 0b11111000, 0b00000000,
	}, {	
	0b00000000, 0b11111000, 0b00000000,
	0b00000011, 0b00100110, 0b00000000,
	0b00001100, 0b01110001, 0b10000000,
	0b00011000, 0b01110000, 0b11000000,
	0b00101111, 0b00000111, 0b10100000,
	0b00101111, 0b00000111, 0b10100000,
	0b01011110, 0b00000011, 0b11010000,
	0b01011110, 0b00000011, 0b11010000,
	0b10011110, 0b00000011, 0b11001000,
	0b10111110, 0b00000011, 0b11101000,
	0b11000001, 0b11111100, 0b00011000,
	0b11000001, 0b11111100, 0b00011000,
	0b11100001, 0b11111100, 0b00111000,
	0b01100001, 0b11111100, 0b00110000,
	0b01100001, 0b11111100, 0b00110000,
	0b00110000, 0b11111000, 0b01100000,
	0b00110000, 0b11111000, 0b01100000,
	0b00010111, 0b10001111, 0b01000000,
	0b00001111, 0b10001111, 0b10000000,
	0b00000011, 0b11011110, 0b00000000,
	0b00000000, 0b11111000, 0b00000000,
	}, {	
	0b00000000, 0b11111000, 0b00000000,
	0b00000011, 0b10010110, 0b00000000,
	0b00001111, 0b00011001, 0b10000000,
	0b00011110, 0b00011100, 0b01000000,
	0b00100011, 0b11100001, 0b11100000,
	0b00100011, 0b11100000, 0b11100000,
	0b01000111, 0b11100000, 0b11110000,
	0b01000111, 0b11100000, 0b11110000,
	0b10000111, 0b11100000, 0b01111000,
	0b10001111, 0b11100000, 0b01111000,
	0b11110000, 0b00011111, 0b10001000,
	0b11110000, 0b00011111, 0b10001000,
	0b11111000, 0b00011111, 0b10001000,
	0b01111000, 0b00011111, 0b00010000,
	0b01111000, 0b00011111, 0b00010000,
	0b00111100, 0b00011111, 0b00100000,
	0b00111100, 0b00011110, 0b00100000,
	0b00010001, 0b11100011, 0b11000000,
	0b00001100, 0b11100111, 0b10000000,
	0b00000011, 0b01101110, 0b00000000,
	0b00000000, 0b11111000, 0b00000000,
	}, {	
	0b00000000, 0b11111000, 0b00000000,
	0b00000011, 0b11011110, 0b00000000,
	0b00001111, 0b10001111, 0b10000000,
	0b00010111, 0b10001111, 0b01000000,
	0b00110000, 0b11111000, 0b01100000,
	0b00110000, 0b11111000, 0b01100000,
	0b01100001, 0b11111100, 0b00110000,
	0b01100001, 0b11111100, 0b00110000,
	0b11100001, 0b11111100, 0b00111000,
	0b11000001, 0b11111100, 0b00011000,
	0b10111110, 0b00000011, 0b11101000,
	0b10111110, 0b00000011, 0b11101000,
	0b10011110, 0b00000011, 0b11001000,
	0b01011110, 0b00000011, 0b11010000,
	0b01011110, 0b00000011, 0b11010000,
	0b00101111, 0b00000111, 0b10100000,
	0b00101111, 0b00000111, 0b10100000,
	0b00011000, 0b01110000, 0b11000000,
	0b00001100, 0b01110001, 0b10000000,
	0b00000011, 0b00100110, 0b00000000,
	0b00000000, 0b11111000, 0b00000000,
	}
};

// Screen memory
char * const Screen = (char *)0x0400;

// Sprite memory, unused if our program is not too large
char * const Sprite = (char *)0x3f00;


int main(void)
{
	// Copy sprite image into VIC available area
	memcpy(Sprite, SpriteImage, 256);

	// Initialize sprite data structures
	spr_init(Screen);

	// Set sprites on screen
	for(char i=0; i<8; i++)
		spr_set(i, true, 30 + 20 * i, 60 + 20 * i, (unsigned)Sprite / 64, i + 7, false, false, false);

	char y = 0;
	while (true)
	{
		// For all sprites
		for(char i=0; i<8; i++)
		{
			// Move them into new position
			spr_move(i, 30 + 20 * i, 60 + 20 * i + y);
			
			// Advance animation frame every four video frames, 
			// animation has a cycle of four
			// Each sprite has a different starting frame
			char frame = ((y >> 2) + i) & 3;

			// Set mew animation frame
			spr_image(i, (unsigned)Sprite / 64 + frame);
		}

		// Move sprites down
		y++;

		// Wait for next video frame
		vic_waitFrame();
	}

	return 0;
}
